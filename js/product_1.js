Product.ACPconfigurable=Class.create();Product.ACPconfigurable.prototype={config:{},initialize:function(a){this.config=a;this.taxConfig=this.config.taxConfig;this.settings=$$(".super-attribute-select-acp");this.state=new Hash();this.priceTemplate=new Template(this.config.template);this.prices=a.prices;this.settings.each(function(h){Event.observe(h,"change",this.configure.bind(this))}.bind(this));this.settings.each(function(h){var i=h.id.replace(/[a-z]*/,"");if(i&&this.config.attributes[i]){h.config=this.config.attributes[i];h.attributeId=i;this.state[i]=false}}.bind(this));var e=[];for(var c=this.settings.length-1;c>=0;c--){var b=this.settings[c-1]?this.settings[c-1]:false;var d=this.settings[c+1]?this.settings[c+1]:false;if(c==0){this.fillSelect(this.settings[c])}else{this.settings[c].disabled=true}$(this.settings[c]).childSettings=e.clone();$(this.settings[c]).prevSetting=b;$(this.settings[c]).nextSetting=d;e.push(this.settings[c])}var g=window.location.href.indexOf("#");if(g!=-1){var f=window.location.href.substr(g+1);this.values=f.toQueryParams();this.settings.each(function(h){var i=h.attributeId;h.value=(typeof(this.values[i])=="undefined")?"":this.values[i];this.configureElement(h)}.bind(this))}},fillSelect:function(f){var h=f.id.replace(/[a-z]*/,"");var d=this.getAttributeOptions(h);this.clearSelect(f);f.options[0]=new Option(this.config.chooseText,"");var a=false;if(f.prevSetting){a=f.prevSetting.options[f.prevSetting.selectedIndex]}if(d){var c=1;for(var e=0;e<d.length;e++){var g=[];if(a){for(var b=0;b<d[e].products.length;b++){if(a.config.allowedProducts&&a.config.allowedProducts.indexOf(d[e].products[b])>-1){g.push(d[e].products[b])}}}else{g=d[e].products.clone()}if(g.size()>0){d[e].allowedProducts=g;f.options[c]=new Option(this.getOptionLabel(d[e],d[e].price),d[e].id);f.options[c].config=d[e];c++}}}},configure:function(b){var a=Event.element(b);this.configureElement(a)},configureElement:function(a){this.reloadOptionLabels(a);if(a.value){this.state[a.config.id]=a.value;if(a.nextSetting){a.nextSetting.disabled=false;this.fillSelect(a.nextSetting);this.resetChildren(a.nextSetting)}}else{this.resetChildren(a)}this.reloadPrice()},getAttributeOptions:function(a){if(this.config.attributes[a]){return this.config.attributes[a].options}},clearSelect:function(b){for(var a=b.options.length-1;a>=0;a--){b.remove(a)}},getOptionLabel:function(c,d){var d=parseFloat(d);if(this.taxConfig.includeTax){var b=d/(100+this.taxConfig.defaultTax)*this.taxConfig.defaultTax;var f=d-b;var a=f*(1+(this.taxConfig.currentTax/100))}else{var b=d*(this.taxConfig.currentTax/100);var f=d;var a=f+b}if(this.taxConfig.showIncludeTax||this.taxConfig.showBothPrices){d=a}else{d=f}var e=c.label;if(d){if(this.taxConfig.showBothPrices){e+=" "+this.formatPrice(f,true)+" ("+this.formatPrice(d,true)+" "+this.taxConfig.inclTaxTitle+")"}else{e+=" "+this.formatPrice(d,true)}}return e},formatPrice:function(b,a){var d="";b=parseFloat(b);if(a){if(b<0){d+="-";b=-b}else{d+="+"}}var c=(Math.round(b*100)/100).toString();if(this.prices&&this.prices[c]){d+=this.prices[c]}else{d+=this.priceTemplate.evaluate({price:b.toFixed(2)})}return d},reloadPrice:function(){var c=0;for(var a=this.settings.length-1;a>=0;a--){var b=this.settings[a].options[this.settings[a].selectedIndex];if(b.config){c+=parseFloat(b.config.price)}}optionsPrice.changePrice("configAcp",c);optionsPrice.reload();return c},reloadOptionLabels:function(c){var a;if(c.options[c.selectedIndex].config){a=parseFloat(c.options[c.selectedIndex].config.price)}else{a=0}for(var b=0;b<c.options.length;b++){if(c.options[b].config){c.options[b].text=this.getOptionLabel(c.options[b].config,c.options[b].config.price-a)}}},resetChildren:function(b){if(b.childSettings){for(var a=0;a<b.childSettings.length;a++){b.childSettings[a].selectedIndex=0;b.childSettings[a].disabled=true;if(b.config){this.state[b.config.id]=false}}}},reloadOldPrice:function(){if($("old-price-"+this.config.productId)){var c=parseFloat(this.config.oldPrice);for(var a=this.settings.length-1;a>=0;a--){var b=this.settings[a].options[this.settings[a].selectedIndex];if(b.config){c+=parseFloat(b.config.price)}}if(c<0){c=0}c=this.formatPrice(c);if($("old-price-"+this.config.productId)){$("old-price-"+this.config.productId).innerHTML=c}}}};Product.DownloadableAcp=Class.create();Product.DownloadableAcp.prototype={config:{},initialize:function(a){this.config=a;this.reloadPrice()},reloadPrice:function(){var c=0;var b=this.config;$$(".product-downloadable-link-acp").each(function(e){if(b[e.value]&&e.checked){c+=parseFloat(b[e.value])}});try{var a=optionsPrice.displayZeroPrice;optionsPrice.displayZeroPrice=false;optionsPrice.changePrice("downloadableAcp",c);optionsPrice.reload();optionsPrice.displayZeroPrice=a}catch(d){}}};function validateDownloadableCallback(c,a){var b=$("downloadable-links-list");if(a=="failed"){b.removeClassName("validation-passed");b.addClassName("validation-failed")}else{b.removeClassName("validation-failed");b.addClassName("validation-passed")}};