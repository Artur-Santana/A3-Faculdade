function Minicart(t){this.formKey=t.formKey,this.previousVal=null,this.defaultErrorMessage="Error occurred. Try to refresh page.",this.selectors={itemRemove:"#header-cart a.remove",container:"#header-cart",inputQty:".cart-item-quantity",qty:".mini-cart span.badge, .skip-cart span.count",overlay:".minicart-wrapper",error:"#minicart-error-message",success:"#minicart-success-message",quantityButtonPrefix:"#qbutton-",quantityInputPrefix:"#qinput-",quantityButtonClass:".quantity-button"},t.selectors&&jQuery.extend(this.selectors,t.selectors)}Minicart.prototype={init:function(){var t=this;jQuery(this.selectors.itemRemove).unbind("click.minicart").bind("click.minicart",function(e){e.preventDefault(),t.removeItem(jQuery(this))}),jQuery(this.selectors.inputQty).unbind("blur.minicart").unbind("focus.minicart").bind("focus.minicart",function(){t.previousVal=jQuery(this).val(),t.displayQuantityButton(jQuery(this))}).bind("blur.minicart",function(){t.revertInvalidValue(this)}),jQuery(this.selectors.quantityButtonClass).unbind("click.quantity").bind("click.quantity",function(){t.processUpdateQuantity(this)})},removeItem:function(t){var e=this;confirm(t.data("confirm"))&&(e.hideMessage(),e.showOverlay(),jQuery.ajax({type:"POST",dataType:"json",data:{form_key:e.formKey},url:t.attr("href")}).done(function(s){e.hideOverlay(),s.success?(e.updateCartQty(s.qty),e.updateContentOnRemove(s,t.closest("li"))):e.showMessage(s)}).error(function(){e.hideOverlay(),e.showError(e.defaultErrorMessage)}))},revertInvalidValue:function(t){this.isValidQty(jQuery(t).val())&&jQuery(t).val()!=this.previousVal||(jQuery(t).val(this.previousVal),this.hideQuantityButton(t))},displayQuantityButton:function(t){var e=this.selectors.quantityButtonPrefix+jQuery(t).data("item-id");jQuery(e).addClass("visible").attr("disabled",null)},hideQuantityButton:function(t){var e=this.selectors.quantityButtonPrefix+jQuery(t).data("item-id");jQuery(e).removeClass("visible").attr("disabled","disabled")},processUpdateQuantity:function(t){var e=jQuery(this.selectors.quantityInputPrefix+jQuery(t).data("item-id"));this.isValidQty(e.val())&&e.val()!=this.previousVal?this.updateItem(t):this.revertInvalidValue(e)},updateItem:function(t){var e=this,s=jQuery(this.selectors.quantityInputPrefix+jQuery(t).data("item-id")),r=parseInt(s.val(),10);return e.hideMessage(),e.showOverlay(),jQuery.ajax({type:"POST",dataType:"json",url:s.data("link"),data:{qty:r,form_key:e.formKey}}).done(function(t){e.hideOverlay(),t.success?(e.updateCartQty(t.qty),0!==r?e.updateContentOnUpdate(t):e.updateContentOnRemove(t,s.closest("li"))):e.showMessage(t)}).error(function(){e.hideOverlay(),e.showError(e.defaultErrorMessage)}),!1},updateContentOnRemove:function(t,e){var s=this;e.hide("slow",function(){jQuery(s.selectors.container).html(t.content),s.showMessage(t)})},updateContentOnUpdate:function(t){jQuery(this.selectors.container).html(t.content),this.showMessage(t)},updateCartQty:function(t){void 0!==t&&jQuery(this.selectors.qty).text(t)},isValidQty:function(t){return t.length>0&&t-0==t&&t-0>0},showOverlay:function(){jQuery(this.selectors.overlay).addClass("loading")},hideOverlay:function(){jQuery(this.selectors.overlay).removeClass("loading")},showMessage:function(t){void 0!==t.notice?this.showError(t.notice):void 0!==t.error?this.showError(t.error):void 0!==t.message&&this.showSuccess(t.message)},hideMessage:function(){jQuery(this.selectors.error).fadeOut("slow"),jQuery(this.selectors.success).fadeOut("slow")},showError:function(t){jQuery(this.selectors.error).text(t).fadeIn("slow")},showSuccess:function(t){jQuery(this.selectors.success).text(t).fadeIn("slow")}};